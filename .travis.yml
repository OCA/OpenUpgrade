language: python

python:
  - "2.7"

env:
  - VERSION="7.0" ODOO_REPO="odoo/odoo"

virtualenv:
  system_site_packages: true

# Need flake8 for pep8 testing
install:
    - pip install flake8
    # Compute Modules to Install
    - ADDONS_LIST =""
    - for module in `cat openerp/openupgrade/doc/source/modules70-80.rst  | grep -i "|.*Done" | cut -d"|" -f2` ; do if [ -z "$ADDONS_LIST" ] ; then ADDONS_LIST=$module; else ADDONS_LIST=$ADDONS_LIST,$module; fi; done
    - echo "Installing Modules : "$ADDONS_LIST
    # Install Maintainer Tools
  - git clone https://github.com/OCA/maintainer-quality-tools.git ${HOME}/maintainer-quality-tools
  - export PATH=${HOME}/maintainer-quality-tools/travis:${PATH}

    # Install Old Version
    - git clone https://github.com/${ODOO_REPO}.git ${HOME}/old-version -b ${VERSION} --depth=1
    - travis_install_nightly
    # Install Module
    # - python ${HOME}/old-version/openerp-server 

# Test with flake for:
#   * migration scripts
#   * scripts/ directory
#   * openerp/addons/openupgrade* directories
#   * openerp/openupgrade/ directory
# use a max length of 120
script:
    - flake8 scripts --max-line-length=120
    - flake8 openerp/openupgrade --max-line-length=120
    - flake8 openerp/addons/openupgrade* --max-line-length=120 --filename=__init__.py --ignore=F401
    - flake8 openerp/addons/openupgrade* --max-line-length=120 --exclude=__init__.py
    - flake8 . --max-line-length=120 --filename=pre-*.py,post-*.py
